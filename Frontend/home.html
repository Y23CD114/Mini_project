<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Learn Flow Â· Projects</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Inter", "Segoe UI", sans-serif;
}

body {
  background: radial-gradient(circle at top left, #1e1b4b, #0f172a 60%);
  color: #e2e8f0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

/* ===== CONTAINER ===== */
.container {
  width: 440px;
}

/* ===== TITLE ===== */
h1 {
  text-align: center;
  margin-bottom: 30px;
  font-size: 32px;
  font-weight: 600;
  background: linear-gradient(90deg, #818cf8, #c084fc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ===== CARD ===== */
.card {
  background: rgba(30, 41, 59, 0.6);
  backdrop-filter: blur(14px);
  padding: 24px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
  margin-bottom: 24px;
  transition: 0.3s ease;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 25px 50px rgba(0,0,0,0.6);
}

.card h3 {
  margin-bottom: 14px;
  font-weight: 500;
  color: #cbd5e1;
}

/* ===== INPUT ===== */
input {
  width: 100%;
  padding: 12px;
  margin-bottom: 16px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
  background: #0f172a;
  color: white;
  outline: none;
  transition: 0.2s ease;
}

input:focus {
  border-color: #818cf8;
  box-shadow: 0 0 0 2px rgba(129,140,248,0.3);
}

/* ===== BUTTON ===== */
button {
  padding: 10px 18px;
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  transition: 0.2s ease;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(139,92,246,0.4);
}

.delete-btn {
  background: linear-gradient(135deg, #ef4444, #dc2626);
}

.delete-btn:hover {
  box-shadow: 0 10px 25px rgba(239,68,68,0.4);
}

/* ===== PROJECT LIST ===== */
.project {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(15, 23, 42, 0.7);
  padding: 14px;
  border-radius: 12px;
  margin-bottom: 12px;
  border: 1px solid rgba(255,255,255,0.05);
  transition: 0.2s ease;
}

.project:hover {
  background: rgba(30, 41, 59, 0.9);
}

.project span {
  font-weight: 500;
}

.project small {
  color: #94a3b8;
  font-size: 12px;
}

.actions {
  display: flex;
  gap: 8px;
}

/* ===== CHATBOT ===== */
#chatToggle {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  color: white;
  border: none;
  border-radius: 50%;
  width: 65px;
  height: 65px;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 15px 35px rgba(99,102,241,0.5);
  transition: 0.3s ease;
  z-index: 9999;
}

#chatToggle:hover {
  transform: scale(1.1);
}

#chatBox {
  position: fixed;
  bottom: 100px;
  right: 25px;
  width: 340px;
  height: 440px;
  background: #0f172a;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.1);
  display: none;
  flex-direction: column;
  overflow: hidden;
  z-index: 9999;
}

#chatHeader {
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  padding: 14px;
  font-weight: 600;
}

#chatMessages {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
  font-size: 14px;
}

.chatMsg {
  margin-bottom: 10px;
}

.userMsg {
  text-align: right;
  color: #a5b4fc;
}

.botMsg {
  text-align: left;
  color: #e2e8f0;
}

#chatInputArea {
  display: flex;
  border-top: 1px solid rgba(255,255,255,0.08);
}

#chatInput {
  flex: 1;
  padding: 10px;
  border: none;
  outline: none;
  background: #1e293b;
  color: white;
}

#chatSend {
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  border: none;
  padding: 10px 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container">
  <h1>Learn Flow</h1>

  <div class="card">
    <h3>Create New Project</h3>
    <input type="text" id="projectName" placeholder="Project name (e.g. Biology Unit 2)">
    <button onclick="createProject()" style="width:100%">Create Project</button>
  </div>

  <div class="card">
    <h3>Your Projects</h3>
    <div id="projectList"></div>
  </div>
</div>

<script>
let projects = JSON.parse(localStorage.getItem("projects")) || [];
const list = document.getElementById("projectList");

function renderProjects() {
  list.innerHTML = "";

  if (!projects.length) {
    list.innerHTML = "<p style='color:#94a3b8;'>No projects yet.</p>";
    return;
  }

  projects.forEach(p => {
    const div = document.createElement("div");
    div.className = "project";

    div.innerHTML = `
      <div>
        <span>${p.name}</span><br>
        <small>Created: ${p.createdAt}</small>
      </div>
      <div class="actions">
        <button onclick="openProject(${p.id})">Open</button>
        <button class="delete-btn" onclick="deleteProject(${p.id})">Delete</button>
      </div>
    `;

    list.appendChild(div);
  });
}

function createProject() {
  const name = document.getElementById("projectName").value.trim();
  if (!name) return alert("Enter a project name.");

  const project = {
    id: Date.now(),
    name,
    createdAt: new Date().toLocaleDateString()
  };

  projects.push(project);
  localStorage.setItem("projects", JSON.stringify(projects));
  document.getElementById("projectName").value = "";
  renderProjects();
}

function openProject(id) {
  localStorage.setItem("currentProjectId", id);
  window.location.href = "index.html";
}

function deleteProject(id) {
  const project = projects.find(p => p.id === id);
  if (!project) return;

  if (!confirm(`Delete project "${project.name}"?`)) return;

  projects = projects.filter(p => p.id !== id);
  localStorage.setItem("projects", JSON.stringify(projects));
  renderProjects();
}

renderProjects();
</script>

<button id="chatToggle">ðŸ’¬</button>

<div id="chatBox">
  <div id="chatHeader">AI Study Assistant</div>
  <div id="chatMessages"></div>
  <div id="chatInputArea">
    <input id="chatInput" placeholder="Ask something..." />
    <button id="chatSend">Send</button>
  </div>
</div>

<script>
const projectId = localStorage.getItem("currentProjectId");
const FULLTEXT_KEY = `fullText_${projectId}`;

const chatToggle = document.getElementById("chatToggle");
const chatBox = document.getElementById("chatBox");
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const chatSend = document.getElementById("chatSend");

chatToggle.onclick = () => {
  chatBox.style.display =
    chatBox.style.display === "flex" ? "none" : "flex";
};

chatSend.onclick = sendMessage;
chatInput.addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});

function addMessage(text, type) {
  const div = document.createElement("div");
  div.className = "chatMsg " + type;
  div.innerText = text;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function sendMessage() {
  const message = chatInput.value.trim();
  if (!message) return;

  addMessage(message, "userMsg");
  chatInput.value = "";

  const fullText = localStorage.getItem(FULLTEXT_KEY) || "";

  try {
    const res = await fetch("http://localhost:3000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message,
        text: fullText
      })
    });

    const data = await res.json();
    addMessage(data.reply, "botMsg");
  } catch {
    addMessage("Error connecting to AI.", "botMsg");
  }
}
</script>

</body>
</html>