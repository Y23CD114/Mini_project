<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flashcards</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Segoe UI", sans-serif;
}

body {
  background: #f4f6fb;
}

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 240px;
  height: 100vh;
  background: linear-gradient(180deg, #5b6cff, #7a5cff);
  padding: 20px;
  color: white;
}

.sidebar a {
  display: block;
  color: white;
  text-decoration: none;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 10px;
}

.sidebar a:hover {
  background: rgba(255,255,255,0.2);
}

/* ===== MAIN ===== */
.main {
  margin-left: 240px;
  padding: 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h2 {
  margin-bottom: 20px;
}

/* ===== FLASHCARD ===== */
.card-container {
  perspective: 1000px;
}

.flashcard {
  width: 380px;
  height: 220px;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.6s;
  cursor: pointer;
}

.flashcard.flipped {
  transform: rotateY(180deg);
}

.card-face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  background: white;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 25px;
  text-align: center;
  font-size: 18px;
  font-weight: 600;
}

.card-back {
  transform: rotateY(180deg);
  background: #eef2ff;
  font-weight: normal;
}

/* ===== NAVIGATION ===== */
.controls {
  margin-top: 30px;
  display: flex;
  align-items: center;
  gap: 20px;
}

.arrow {
  font-size: 24px;
  background: #4f46e5;
  color: white;
  border: none;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  cursor: pointer;
}

.arrow:hover {
  background: #4338ca;
}

.progress {
  font-size: 14px;
  color: #555;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <a href="index.html"><h2>Learn Flow</h2></a>
  <a href="index.html">Dashboard</a>
  <a href="upload.html">Upload Notes</a>
  <a href="flashcards.html">Flashcards</a>
  <a href="quiz.html">Quiz</a>
  <a href="tasks.html">Tasks</a>
</div>

<!-- MAIN -->
<div class="main">
  <h2>ðŸ§  Flashcards</h2>

  <div class="card-container">
    <div class="flashcard" id="flashcard" onclick="flipCard()">
      <div class="card-face card-front" id="question"></div>
      <div class="card-face card-back" id="answer"></div>
    </div>
  </div>

  <div class="controls">
    <button class="arrow" onclick="prevCard()">â¬…</button>
    <div class="progress" id="progress"></div>
    <button class="arrow" onclick="nextCard()">âž¡</button>
    <button class="arrow" onclick="loadMore()">âž•</button>
  </div>
</div>

<script>
// ===============================
// LOAD FLASHCARDS (SAFE)
// ===============================
let rawCards = JSON.parse(localStorage.getItem("flashcards")) || [];

let flashcards = rawCards
  .map(card => {
    if (card.q && card.a) return card;
    if (card.question && card.answer) {
      return { q: card.question, a: card.answer };
    }
    return null;
  })
  .filter(Boolean);

if (flashcards.length === 0) {
  flashcards = [{
    q: "No flashcards found",
    a: "Please upload a PDF first."
  }];
}

let current = 0;
const card = document.getElementById("flashcard");
const question = document.getElementById("question");
const answer = document.getElementById("answer");
const progress = document.getElementById("progress");

function updateCard() {
  if (!flashcards.length) {
    question.innerText = "No flashcards found";
    answer.innerText = "Please upload a PDF first.";
    progress.innerText = "0 / 0";
    return;
  }

  const c = flashcards[current];
  question.innerText = c.q || "No question";
  answer.innerText = c.a || "No answer";
  progress.innerText = `${current + 1} / ${flashcards.length}`;
  card.classList.remove("flipped");
}

function flipCard() {
  card.classList.toggle("flipped");
}

function nextCard() {
  if (current < flashcards.length - 1) {
    current++;
    updateCard();
  }
}

function prevCard() {
  if (current > 0) {
    current--;
    updateCard();
  }
}

// ===============================
// LOAD MORE
// ===============================
let fullText = localStorage.getItem("fullText") || "";
let nextIndex = parseInt(localStorage.getItem("nextIndex") || "0");

async function loadMore() {
  const res = await fetch("http://localhost:3000/load-more", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text: fullText, start: nextIndex })
  });

  const data = await res.json();

  const newCards = (data.flashcards || []).map(card => ({
    q: card.question,
    a: card.answer
  }));

  flashcards = flashcards.concat(newCards);
  nextIndex = data.nextIndex || nextIndex;

  localStorage.setItem("flashcards", JSON.stringify(flashcards));
  localStorage.setItem("nextIndex", nextIndex);

  updateCard();
}

updateCard();
</script>

<!-- ===============================
     REFRESH WARNING
     ONLY ON REFRESH / TAB CLOSE
     =============================== -->
<script>
let isReload = false;

window.addEventListener("keydown", e => {
  if (e.key === "F5" || (e.ctrlKey && e.key === "r") || (e.metaKey && e.key === "r")) {
    isReload = true;
  }
});

window.addEventListener("beforeunload", function (e) {
  if (isReload && localStorage.getItem("flashcards")) {
    e.preventDefault();
    e.returnValue = "";
  }
});
</script>

</body>
</html>
